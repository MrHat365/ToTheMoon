# 交易所配置系统

本文档说明如何通过 `config.yaml` 文件配置交易所列表。

## 功能概述

- ✅ 通过 YAML 配置文件动态管理交易所列表
- ✅ 支持配置热重载（无需重启应用）
- ✅ 自动降级到默认配置
- ✅ 实时状态监控和错误处理
- ✅ 用户友好的配置管理界面

## 配置文件格式

### 文件位置
```
/Users/wyfz/Documents/dev_workspace/nodejs/to_the_moon/config.yaml
```

### 配置格式
```yaml
EXCHANGES:
  - Binance
  - OKX
  - Bybit
  - Bitget
  - Coinbase
  - Kraken
```

## 使用方法

### 1. 修改交易所列表

编辑 `config.yaml` 文件：

```yaml
EXCHANGES:
  - Binance      # 第一个交易所将作为默认选项
  - OKX
  - Bybit
  - Bitget
  - Coinbase
  - Kraken
  - Huobi       # 添加新的交易所
```

### 2. 应用配置更改

修改配置文件后，有两种方式应用更改：

**方式一：通过Web界面**
1. 访问 "系统配置" 页面 (`/config`)
2. 点击 "刷新配置" 按钮

**方式二：自动重载**
- 新用户访问时会自动加载最新配置
- 现有用户需要刷新页面

### 3. 验证配置

访问配置页面验证：
- 查看加载状态（成功/失败）
- 确认交易所列表正确
- 检查默认交易所设置

## 技术实现

### 核心组件

1. **配置管理器** (`lib/config.ts`)
   - 读取和解析 YAML 文件
   - 提供配置缓存和重载功能
   - 处理错误和降级策略

2. **API接口** (`/api/config/exchanges`)
   - 为前端提供交易所列表
   - 支持实时配置更新

3. **React Hook** (`hooks/use-exchanges.ts`)
   - 管理配置状态
   - 提供加载状态和错误处理
   - 支持手动重载

4. **UI组件更新**
   - 模板对话框使用动态交易所列表
   - 加载状态和错误处理
   - 配置管理页面

### 默认配置

如果配置文件不存在或格式错误，系统将使用以下默认配置：

```javascript
{
  EXCHANGES: ['Binance', 'Coinbase', 'Kraken']
}
```

### 错误处理

- **文件不存在**: 使用默认配置，控制台显示警告
- **格式错误**: 使用默认配置，显示错误信息
- **网络错误**: 前端显示错误状态，提供重试选项

## 注意事项

1. **YAML格式**: 确保使用标准YAML数组格式（以 `-` 开头）
2. **字符编码**: 使用 UTF-8 编码保存文件
3. **交易所顺序**: 第一个交易所将作为新模板的默认选项
4. **缓存机制**: 配置在服务器内存中缓存，修改后需要刷新

## 扩展功能

未来可以扩展的功能：
- 交易所连接状态检测
- 交易所特定配置参数
- 多环境配置文件支持
- 配置文件版本控制